<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§‘æŠ€ç³»ç»Ÿå¢é‡å‡çº§æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            padding: 20px;
            background-color: #1a1a2e;
            color: #eee;
        }
        h1 { color: #4CAF50; }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background-color: #2a2a4e;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background-color: #1a1a3e;
            border-radius: 5px;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        .highlight { color: #FFD700; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç§‘æŠ€ç³»ç»Ÿå¢é‡å‡çº§æµ‹è¯•</h1>
    <div id="output"></div>

    <script src="player.js"></script>
    <script src="tech.js"></script>
    <script src="weapon.js"></script>

    <script>
        const output = document.getElementById('output');

        function log(message, className = 'info') {
            const div = document.createElement('div');
            div.className = `result ${className}`;
            div.innerHTML = message;
            output.appendChild(div);
        }

        function section(title) {
            const div = document.createElement('div');
            div.className = 'test-section';
            div.innerHTML = `<h2>${title}</h2>`;
            output.appendChild(div);
            return div;
        }

        // æµ‹è¯•1: éªŒè¯å¢é‡é€»è¾‘
        function test1() {
            const sec = section('æµ‹è¯•1: éªŒè¯ç§‘æŠ€æ•°æ®ç»“æ„');
            
            const tech = TechUpgrades.BASIC_GUN_DAMAGE;
            sec.innerHTML += `<div class="result">ç§‘æŠ€åç§°: ${tech.name}</div>`;
            sec.innerHTML += `<div class="result">æè¿°: ${tech.description}</div>`;
            sec.innerHTML += `<div class="result info">æ¯çº§å¢é‡: damage +${tech.upgradePerLevel.damage}</div>`;
            
            // æµ‹è¯•getTotalUpgrade
            sec.innerHTML += `<div class="result"><strong>ç­‰çº§å‡çº§æ•ˆæœ:</strong></div>`;
            for (let i = 1; i <= 5; i++) {
                const upgrade = tech.getTotalUpgrade(i);
                sec.innerHTML += `<div class="result">Lv${i}: damage +${upgrade.damage} (=${tech.upgradePerLevel.damage} Ã— ${i})</div>`;
            }
            sec.innerHTML += `<div class="result success">âœ“ å¢é‡è®¡ç®—æ­£ç¡®</div>`;
        }

        // æµ‹è¯•2: éªŒè¯æ­¦å™¨å±æ€§åº”ç”¨
        function test2() {
            const sec = section('æµ‹è¯•2: éªŒè¯æ­¦å™¨å±æ€§å¢é‡åº”ç”¨');
            
            const player = new Player();
            const techSystem = new TechSystem(player);
            
            // ç»™äºˆèµ„æº
            player.addResource('iron', 1000);
            player.addResource('copper', 1000);
            
            // è·å–åŸå§‹æ­¦å™¨
            const originalWeapon = WeaponPresets.BASIC_GUN;
            sec.innerHTML += `<div class="result info">åŸå§‹é€Ÿå°„ç‚®å±æ€§:</div>`;
            sec.innerHTML += `<div class="result">- ä¼¤å®³: ${originalWeapon.damage}</div>`;
            sec.innerHTML += `<div class="result">- å†·å´: ${originalWeapon.cooldown}ms</div>`;
            sec.innerHTML += `<div class="result">- å­å¼¹é€Ÿåº¦: ${originalWeapon.bulletSpeed}</div>`;
            
            // å‡çº§ä¼¤å®³åˆ°Lv3
            for (let i = 0; i < 3; i++) {
                techSystem.upgrade('BASIC_GUN_DAMAGE');
            }
            sec.innerHTML += `<div class="result highlight">å·²å‡çº§ä¼¤å®³åˆ° Lv3</div>`;
            
            // å‡çº§å†·å´åˆ°Lv2
            for (let i = 0; i < 2; i++) {
                techSystem.upgrade('BASIC_GUN_COOLDOWN');
            }
            sec.innerHTML += `<div class="result highlight">å·²å‡çº§å†·å´åˆ° Lv2</div>`;
            
            // åº”ç”¨å‡çº§
            const upgradedWeapon = techSystem.applyUpgradesToWeapon(originalWeapon);
            
            sec.innerHTML += `<div class="result info">å‡çº§åé€Ÿå°„ç‚®å±æ€§:</div>`;
            sec.innerHTML += `<div class="result success">- ä¼¤å®³: ${upgradedWeapon.damage} (${originalWeapon.damage} + 2Ã—3 = ${originalWeapon.damage + 6})</div>`;
            sec.innerHTML += `<div class="result success">- å†·å´: ${upgradedWeapon.cooldown}ms (${originalWeapon.cooldown} - 200Ã—2 = ${originalWeapon.cooldown - 400})</div>`;
            sec.innerHTML += `<div class="result">- å­å¼¹é€Ÿåº¦: ${upgradedWeapon.bulletSpeed} (æœªå‡çº§)</div>`;
            
            // éªŒè¯
            const expectedDamage = originalWeapon.damage + 6;
            const expectedCooldown = originalWeapon.cooldown - 400;
            
            if (upgradedWeapon.damage === expectedDamage && upgradedWeapon.cooldown === expectedCooldown) {
                sec.innerHTML += `<div class="result success">âœ“ å¢é‡åº”ç”¨æ­£ç¡®ï¼</div>`;
            } else {
                sec.innerHTML += `<div class="result error">âœ— å¢é‡åº”ç”¨é”™è¯¯</div>`;
                sec.innerHTML += `<div class="result error">æœŸæœ›ä¼¤å®³: ${expectedDamage}, å®é™…: ${upgradedWeapon.damage}</div>`;
                sec.innerHTML += `<div class="result error">æœŸæœ›å†·å´: ${expectedCooldown}, å®é™…: ${upgradedWeapon.cooldown}</div>`;
            }
        }

        // æµ‹è¯•3: éªŒè¯å¤šä¸ªç§‘æŠ€å åŠ 
        function test3() {
            const sec = section('æµ‹è¯•3: éªŒè¯å¤šä¸ªç§‘æŠ€å åŠ æ•ˆæœ');
            
            const player = new Player();
            const techSystem = new TechSystem(player);
            
            player.addResource('iron', 2000);
            player.addResource('copper', 2000);
            player.addResource('cobalt', 500);
            
            const originalWeapon = WeaponPresets.SHOTGUN;
            sec.innerHTML += `<div class="result info">åŸå§‹éœ°å¼¹æªå±æ€§:</div>`;
            sec.innerHTML += `<div class="result">- ä¼¤å®³: ${originalWeapon.damage}</div>`;
            sec.innerHTML += `<div class="result">- å­å¼¹æ•°: ${originalWeapon.bulletsPerShot}</div>`;
            sec.innerHTML += `<div class="result">- æ•£å°„è§’: ${originalWeapon.bulletSpreadAngle}Â°</div>`;
            
            // å‡çº§ä¼¤å®³
            for (let i = 0; i < 5; i++) {
                techSystem.upgrade('SHOTGUN_DAMAGE');
            }
            sec.innerHTML += `<div class="result highlight">ä¼¤å®³ Lv5: +${1 * 5}</div>`;
            
            // å‡çº§å­å¼¹æ•°
            for (let i = 0; i < 3; i++) {
                techSystem.upgrade('SHOTGUN_BULLETS');
            }
            sec.innerHTML += `<div class="result highlight">å­å¼¹æ•° Lv3: +${2 * 3}</div>`;
            
            // å‡çº§ç²¾å‡†åº¦
            for (let i = 0; i < 4; i++) {
                techSystem.upgrade('SHOTGUN_SPREAD');
            }
            sec.innerHTML += `<div class="result highlight">æ•£å°„è§’ Lv4: ${-0.5 * 4}Â°</div>`;
            
            const upgradedWeapon = techSystem.applyUpgradesToWeapon(originalWeapon);
            
            sec.innerHTML += `<div class="result info">å‡çº§åéœ°å¼¹æªå±æ€§:</div>`;
            sec.innerHTML += `<div class="result success">- ä¼¤å®³: ${upgradedWeapon.damage} (${originalWeapon.damage} + 5 = ${originalWeapon.damage + 5})</div>`;
            sec.innerHTML += `<div class="result success">- å­å¼¹æ•°: ${upgradedWeapon.bulletsPerShot} (${originalWeapon.bulletsPerShot} + 6 = ${originalWeapon.bulletsPerShot + 6})</div>`;
            sec.innerHTML += `<div class="result success">- æ•£å°„è§’: ${upgradedWeapon.bulletSpreadAngle}Â° (${originalWeapon.bulletSpreadAngle} - 2 = ${originalWeapon.bulletSpreadAngle - 2})</div>`;
            
            const expectedDamage = originalWeapon.damage + 5;
            const expectedBullets = originalWeapon.bulletsPerShot + 6;
            const expectedSpread = originalWeapon.bulletSpreadAngle - 2;
            
            if (upgradedWeapon.damage === expectedDamage && 
                upgradedWeapon.bulletsPerShot === expectedBullets &&
                upgradedWeapon.bulletSpreadAngle === expectedSpread) {
                sec.innerHTML += `<div class="result success">âœ“ å¤šä¸ªç§‘æŠ€å åŠ æ­£ç¡®ï¼</div>`;
            } else {
                sec.innerHTML += `<div class="result error">âœ— å¤šä¸ªç§‘æŠ€å åŠ é”™è¯¯</div>`;
            }
        }

        // æµ‹è¯•4: éªŒè¯ä¸ä¼šæ±¡æŸ“åŸå§‹æ•°æ®
        function test4() {
            const sec = section('æµ‹è¯•4: éªŒè¯ä¸ä¼šæ±¡æŸ“åŸå§‹æ­¦å™¨æ•°æ®');
            
            const player = new Player();
            const techSystem = new TechSystem(player);
            
            player.addResource('iron', 500);
            player.addResource('copper', 500);
            
            const originalWeapon = WeaponPresets.BASIC_GUN;
            const originalDamage = originalWeapon.damage;
            
            // å‡çº§å¹¶åº”ç”¨
            for (let i = 0; i < 5; i++) {
                techSystem.upgrade('BASIC_GUN_DAMAGE');
            }
            const upgradedWeapon = techSystem.applyUpgradesToWeapon(originalWeapon);
            
            sec.innerHTML += `<div class="result">åŸå§‹æ­¦å™¨ä¼¤å®³: ${originalWeapon.damage}</div>`;
            sec.innerHTML += `<div class="result">å‡çº§åæ­¦å™¨ä¼¤å®³: ${upgradedWeapon.damage}</div>`;
            
            if (originalWeapon.damage === originalDamage) {
                sec.innerHTML += `<div class="result success">âœ“ åŸå§‹æ•°æ®æœªè¢«æ±¡æŸ“</div>`;
            } else {
                sec.innerHTML += `<div class="result error">âœ— åŸå§‹æ•°æ®è¢«æ±¡æŸ“äº†ï¼</div>`;
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        try {
            test1();
            test2();
            test3();
            test4();
            
            const finalSec = section('ğŸ‰ æµ‹è¯•æ€»ç»“');
            finalSec.innerHTML += `<div class="result success" style="font-size: 18px;">æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç§‘æŠ€ç³»ç»Ÿå¢é‡é€»è¾‘å·¥ä½œæ­£å¸¸ï¼</div>`;
            finalSec.innerHTML += `<div class="result info">âœ“ ç§‘æŠ€å‡çº§ä½¿ç”¨å¢é‡å€¼</div>`;
            finalSec.innerHTML += `<div class="result info">âœ“ åº”ç”¨æ—¶æ­£ç¡®å åŠ åˆ°åŸå§‹å±æ€§</div>`;
            finalSec.innerHTML += `<div class="result info">âœ“ å¤šä¸ªç§‘æŠ€å¯ä»¥å åŠ </div>`;
            finalSec.innerHTML += `<div class="result info">âœ“ ä¸æ±¡æŸ“åŸå§‹æ­¦å™¨æ•°æ®</div>`;
        } catch (error) {
            log(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            console.error(error);
        }
    </script>
</body>
</html>
