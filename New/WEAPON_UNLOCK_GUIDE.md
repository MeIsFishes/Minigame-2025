# æ­¦å™¨è§£é”ç³»ç»Ÿè¯´æ˜æ–‡æ¡£

## æ¦‚è¿°

ä¸ºæ¸¸æˆæ·»åŠ äº†å®Œæ•´çš„æ­¦å™¨è§£é”æœºåˆ¶ï¼Œç©å®¶éœ€è¦æ¶ˆè€—èµ„æºæ¥è§£é”é«˜çº§æ­¦å™¨ã€‚

## å®ç°åŠŸèƒ½

### 1. æ­¦å™¨è§£é”æ¶ˆè€—é…ç½® (`weapon.js`)

æ¯ä¸ªæ­¦å™¨ç°åœ¨éƒ½æœ‰ `unlockCost` å­—æ®µï¼Œå®šä¹‰è§£é”æ‰€éœ€èµ„æºï¼š

```javascript
unlockCost: { iron: 50, copper: 30 }  // ç¤ºä¾‹ï¼šéœ€è¦50é“å’Œ30é“œ
```

#### æ‰€æœ‰æ­¦å™¨çš„è§£é”æ¶ˆè€—

| æ­¦å™¨ | è§£é”æ¶ˆè€— | è¯´æ˜ |
|------|---------|------|
| **é€Ÿå°„ç‚®** | æ—  | åˆå§‹æ‹¥æœ‰ |
| **éœ°å¼¹æª** | é“Ã—50, é“œÃ—30 | è¿‘è·ç¦»æ•£å°„æ­¦å™¨ |
| **ç‹™å‡»æª** | é“Ã—80, é“œÃ—50, é’´Ã—20 | è¿œç¨‹ç²¾å‡†æ­¦å™¨ |
| **æœºæª** | é“Ã—100, é“œÃ—80 | è¿å‘æ­¦å™¨ |
| **å¯¼å¼¹** | é“Ã—150, é“œÃ—100, é’´Ã—50, é•Ã—30 | çˆ†ç‚¸èŒƒå›´æ­¦å™¨ |
| **ç©¿é€å¼¹** | é“Ã—120, é“œÃ—90, é•Ã—40 | ç©¿é€æ•Œæœº |

### 2. ç©å®¶ç³»ç»Ÿæ›´æ–° (`player.js`)

#### æ–°å¢å±æ€§
```javascript
this.unlockedWeapons = new Set(); // å·²è§£é”çš„æ­¦å™¨IDé›†åˆ
```

#### æ–°å¢æ–¹æ³•

**`initializeUnlockedWeapons()`**
- è‡ªåŠ¨è§£é”æ¶ˆè€—ä¸ºç©ºæˆ–å…¨0çš„æ­¦å™¨ï¼ˆå¦‚é€Ÿå°„ç‚®ï¼‰

**`isWeaponUnlocked(weaponId)`**
- æ£€æŸ¥æŒ‡å®šæ­¦å™¨æ˜¯å¦å·²è§£é”
- è¿”å›ï¼š`boolean`

**`unlockWeapon(weaponId, cost)`**
- è§£é”æŒ‡å®šæ­¦å™¨
- å‚æ•°ï¼š
  - `weaponId`: æ­¦å™¨IDï¼ˆå¦‚ 'SHOTGUN'ï¼‰
  - `cost`: èµ„æºæ¶ˆè€—å¯¹è±¡ï¼ˆå¦‚ `{iron: 50, copper: 30}`ï¼‰
- è¿”å›ï¼š`{ success: boolean, message: string }`
- åŠŸèƒ½ï¼š
  1. æ£€æŸ¥æ­¦å™¨æ˜¯å¦å­˜åœ¨
  2. æ£€æŸ¥æ˜¯å¦å·²è§£é”
  3. æ£€æŸ¥èµ„æºæ˜¯å¦å……è¶³
  4. æ‰£é™¤èµ„æº
  5. è§£é”æ­¦å™¨

**`getUnlockedWeapons()`**
- è·å–æ‰€æœ‰å·²è§£é”çš„æ­¦å™¨IDæ•°ç»„
- è¿”å›ï¼š`string[]`

### 3. æ­¦å™¨é…ç½®ç•Œé¢æ›´æ–° (`lobby.js`)

#### è§†è§‰æ•ˆæœ

**æœªè§£é”æ­¦å™¨æ˜¾ç¤ºï¼š**
- å¡ç‰‡èƒŒæ™¯å˜æš—ï¼ˆ`#1a1a2e`ï¼‰
- è¾¹æ¡†å˜ç°ï¼ˆ`#666666`ï¼‰
- é¢œè‰²æ¡å˜ç°ï¼ˆ`#555555`ï¼‰
- æ·»åŠ åŠé€æ˜é®ç½©ï¼ˆ`rgba(0, 0, 0, 0.6)`ï¼‰
- æ˜¾ç¤ºé”å®šå›¾æ ‡ ğŸ”’
- æ­¦å™¨åç§°å˜ç°ï¼ˆ`#888888`ï¼‰

**å·²è§£é”æ­¦å™¨æ˜¾ç¤ºï¼š**
- æ­£å¸¸é¢œè‰²å’Œæ ·å¼
- å¯ä»¥ç‚¹å‡»é€‰æ‹©

#### äº¤äº’åŠŸèƒ½

- ç‚¹å‡»æœªè§£é”æ­¦å™¨æ—¶æ˜¾ç¤ºé”™è¯¯æç¤ºï¼š"æ­¦å™¨æœªè§£é”ï¼Œè¯·å‰å¾€ç§‘æŠ€å‡çº§ç•Œé¢è§£é”"
- æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
- åªæœ‰å·²è§£é”çš„æ­¦å™¨æ‰èƒ½é…ç½®åˆ°é”®ä½æ’

### 4. ç§‘æŠ€å‡çº§ç•Œé¢æ›´æ–° (`lobby.js`)

#### æ­¦å™¨å¡ç‰‡é«˜åº¦è°ƒæ•´
- ä» 100px å¢åŠ åˆ° 140px
- ç”¨äºå®¹çº³è§£é”æŒ‰é’®

#### æœªè§£é”æ­¦å™¨å¡ç‰‡

**æ˜¾ç¤ºå†…å®¹ï¼š**
1. **æ­¦å™¨åç§°**ï¼ˆç°è‰²ï¼‰
2. **è§£é”æ¶ˆè€—æç¤º**ï¼š"è§£é”æ¶ˆè€—ï¼š"
3. **èµ„æºåˆ—è¡¨**ï¼š
   - æ ¼å¼ï¼š`é“:50 é“œ:30`
   - é¢œè‰²ï¼šé‡‘è‰²ï¼ˆ`#FFD700`ï¼‰
4. **è§£é”æŒ‰é’®**ï¼š
   - ä½ç½®ï¼šå¡ç‰‡åº•éƒ¨
   - å°ºå¯¸ï¼šå®½åº¦ï¼ˆå¡ç‰‡å®½-40ï¼‰ï¼Œé«˜åº¦30px
   - æ–‡å­—ï¼š
     - èµ„æºå……è¶³ï¼š`ğŸ”“ è§£é”æ­¦å™¨`ï¼ˆç»¿è‰²èƒŒæ™¯ `#4CAF50`ï¼‰
     - èµ„æºä¸è¶³ï¼š`èµ„æºä¸è¶³`ï¼ˆç°è‰²èƒŒæ™¯ `#666666`ï¼‰

**äº¤äº’é€»è¾‘ï¼š**
- ç‚¹å‡»è§£é”æŒ‰é’®ï¼š
  - æ£€æŸ¥èµ„æºæ˜¯å¦å……è¶³
  - è°ƒç”¨ `player.unlockWeapon()`
  - æˆåŠŸï¼šæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼Œæ’­æ”¾éŸ³æ•ˆ
  - å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
- ç‚¹å‡»å¡ç‰‡å…¶ä»–åŒºåŸŸï¼šæç¤º"è¯·å…ˆè§£é”è¯¥æ­¦å™¨"

#### å·²è§£é”æ­¦å™¨å¡ç‰‡

**æ˜¾ç¤ºå†…å®¹ï¼š**
1. æ­¦å™¨åç§°ï¼ˆæ­£å¸¸é¢œè‰²ï¼‰
2. ç§‘æŠ€å‡çº§æ•°é‡ï¼š`3/5 å·²å‡çº§`
3. ç­‰çº§è¿›åº¦ï¼š`ç­‰çº§: 8/15`
4. æç¤ºæ–‡å­—ï¼š`ç‚¹å‡»æŸ¥çœ‹ç§‘æŠ€ >`ï¼ˆæ©™è‰²ï¼‰

**äº¤äº’é€»è¾‘ï¼š**
- ç‚¹å‡»å¡ç‰‡ï¼šè¿›å…¥è¯¥æ­¦å™¨çš„ç§‘æŠ€å‡çº§åˆ—è¡¨

## ä½¿ç”¨æµç¨‹

### ç©å®¶è§†è§’

1. **æ¸¸æˆå¼€å§‹**
   - è‡ªåŠ¨æ‹¥æœ‰é€Ÿå°„ç‚®ï¼ˆå…è´¹æ­¦å™¨ï¼‰
   - å…¶ä»–æ­¦å™¨å¤„äºé”å®šçŠ¶æ€

2. **æŸ¥çœ‹æœªè§£é”æ­¦å™¨**
   - è¿›å…¥"æ­¦å™¨é…ç½®"ç•Œé¢
   - çœ‹åˆ°é”å®šå›¾æ ‡ ğŸ”’ çš„æ­¦å™¨
   - ç‚¹å‡»æç¤º"è¯·å‰å¾€ç§‘æŠ€å‡çº§ç•Œé¢è§£é”"

3. **è§£é”æ­¦å™¨**
   - è¿›å…¥"ç§‘æŠ€å‡çº§"ç•Œé¢
   - æ‰¾åˆ°æƒ³è¦è§£é”çš„æ­¦å™¨å¡ç‰‡
   - æŸ¥çœ‹è§£é”æ¶ˆè€—ï¼ˆå¦‚ï¼šé“Ã—50, é“œÃ—30ï¼‰
   - æ£€æŸ¥è‡ªå·±çš„èµ„æºæ˜¯å¦å……è¶³
   - ç‚¹å‡»"ğŸ”“ è§£é”æ­¦å™¨"æŒ‰é’®
   - çœ‹åˆ°æˆåŠŸæç¤ºï¼š"æˆåŠŸè§£é” éœ°å¼¹æªï¼"

4. **é…ç½®è§£é”çš„æ­¦å™¨**
   - è¿”å›"æ­¦å™¨é…ç½®"ç•Œé¢
   - ç°åœ¨å¯ä»¥é€‰æ‹©åˆšè§£é”çš„æ­¦å™¨
   - å°†å…¶é…ç½®åˆ°ä»»æ„é”®ä½æ’

5. **å‡çº§è§£é”çš„æ­¦å™¨**
   - åœ¨"ç§‘æŠ€å‡çº§"ç•Œé¢
   - ç‚¹å‡»å·²è§£é”çš„æ­¦å™¨å¡ç‰‡
   - æŸ¥çœ‹å¹¶å‡çº§è¯¥æ­¦å™¨çš„ç§‘æŠ€

### å¼€å‘è€…è§†è§’

#### æ·»åŠ æ–°æ­¦å™¨å¹¶è®¾ç½®è§£é”æ¶ˆè€—

```javascript
NEW_WEAPON: new WeaponData({
    id: 'NEW_WEAPON',
    name: 'æ–°æ­¦å™¨',
    // ... å…¶ä»–æ­¦å™¨å±æ€§
    unlockCost: {
        iron: 200,
        copper: 150,
        cobalt: 80,
        nickel: 50,
        gold: 10
    }
})
```

#### åˆ›å»ºå…è´¹æ­¦å™¨ï¼ˆåˆå§‹æ‹¥æœ‰ï¼‰

```javascript
FREE_WEAPON: new WeaponData({
    id: 'FREE_WEAPON',
    name: 'å…è´¹æ­¦å™¨',
    // ... å…¶ä»–æ­¦å™¨å±æ€§
    unlockCost: {}  // ç©ºå¯¹è±¡ï¼Œæˆ–è€…çœç•¥æ­¤å­—æ®µ
})
```

## æ•°æ®æŒä¹…åŒ–

è§£é”çŠ¶æ€å­˜å‚¨åœ¨ `player.unlockedWeapons` (Set) ä¸­ï¼š

```javascript
// ç¤ºä¾‹ï¼šå·²è§£é”çš„æ­¦å™¨
player.unlockedWeapons = Set(['BASIC_GUN', 'SHOTGUN', 'SNIPER'])
```

**æ³¨æ„**ï¼šéœ€è¦åœ¨ä¿å­˜/è¯»å–æ¸¸æˆæ—¶å¤„ç†è¿™ä¸ª Set çš„åºåˆ—åŒ–ã€‚

å»ºè®®åœ¨ `player.js` çš„ `exportData()` å’Œ `importData()` ä¸­æ·»åŠ ï¼š

```javascript
// exportData()
exportData() {
    return {
        // ... å…¶ä»–æ•°æ®
        unlockedWeapons: Array.from(this.unlockedWeapons)
    };
}

// importData()
importData(data) {
    // ... å…¶ä»–æ•°æ®
    if (data.unlockedWeapons) {
        this.unlockedWeapons = new Set(data.unlockedWeapons);
    }
}
```

## æŠ€æœ¯ç»†èŠ‚

### è§£é”æ£€æŸ¥é€»è¾‘

```javascript
// åœ¨åˆå§‹åŒ–æ—¶è‡ªåŠ¨è§£é”å…è´¹æ­¦å™¨
initializeUnlockedWeapons() {
    for (const [weaponId, weaponData] of Object.entries(WeaponPresets)) {
        const unlockCost = weaponData.unlockCost || {};
        const costValues = Object.values(unlockCost);
        if (costValues.length === 0 || costValues.every(v => v === 0)) {
            this.unlockedWeapons.add(weaponId);
        }
    }
}
```

### è§£é”æµç¨‹

```javascript
unlockWeapon(weaponId, cost) {
    // 1. éªŒè¯æ­¦å™¨å­˜åœ¨
    if (!WeaponPresets[weaponId]) {
        return { success: false, message: 'æ­¦å™¨ä¸å­˜åœ¨' };
    }
    
    // 2. æ£€æŸ¥æ˜¯å¦å·²è§£é”
    if (this.unlockedWeapons.has(weaponId)) {
        return { success: false, message: 'æ­¦å™¨å·²è§£é”' };
    }
    
    // 3. æ£€æŸ¥èµ„æº
    for (const [type, amount] of Object.entries(cost)) {
        if (this.resources[type] < amount) {
            return { success: false, message: 'èµ„æºä¸è¶³' };
        }
    }
    
    // 4. æ‰£é™¤èµ„æº
    for (const [type, amount] of Object.entries(cost)) {
        this.resources[type] -= amount;
    }
    
    // 5. è§£é”æ­¦å™¨
    this.unlockedWeapons.add(weaponId);
    
    return { success: true, message: 'è§£é”æˆåŠŸ' };
}
```

## å¹³è¡¡æ€§å»ºè®®

### èµ„æºè·å–ä¸è§£é”æˆæœ¬

ç¡®ä¿ç©å®¶èƒ½å¤Ÿé€šè¿‡åˆç†çš„æ¸¸æˆæµç¨‹è§£é”æ‰€æœ‰æ­¦å™¨ï¼š

1. **åˆæœŸ**ï¼ˆå…³å¡1-2ï¼‰
   - ç§¯ç´¯åŸºç¡€èµ„æºï¼ˆé“ã€é“œï¼‰
   - è§£é”éœ°å¼¹æªï¼ˆé“Ã—50, é“œÃ—30ï¼‰

2. **ä¸­æœŸ**ï¼ˆå…³å¡3-4ï¼‰
   - è·å¾—ç¨€æœ‰èµ„æºï¼ˆé’´ã€é•ï¼‰
   - è§£é”ç‹™å‡»æªã€æœºæª

3. **åæœŸ**ï¼ˆå…³å¡5+ï¼‰
   - å¤§é‡èµ„æºç§¯ç´¯
   - è§£é”å¯¼å¼¹ã€ç©¿é€å¼¹ç­‰é«˜çº§æ­¦å™¨

### è§£é”é¡ºåºå»ºè®®

1. é€Ÿå°„ç‚®ï¼ˆå…è´¹ï¼‰
2. éœ°å¼¹æªï¼ˆåŸºç¡€è¿‘æˆ˜ï¼‰
3. æœºæªï¼ˆè¿å‘è¾“å‡ºï¼‰
4. ç©¿é€å¼¹ï¼ˆå¤šç›®æ ‡ï¼‰
5. ç‹™å‡»æªï¼ˆç²¾å‡†æ‰“å‡»ï¼‰
6. å¯¼å¼¹ï¼ˆèŒƒå›´ä¼¤å®³ï¼‰

## æœªæ¥æ‰©å±•

å¯ä»¥æ·»åŠ çš„åŠŸèƒ½ï¼š

1. **æ­¦å™¨å‡çº§å‰ç½®æ¡ä»¶**
   - éœ€è¦å…ˆè§£é”æŸäº›æ­¦å™¨æ‰èƒ½è§£é”é«˜çº§æ­¦å™¨

2. **è§£é”æˆå°±ç³»ç»Ÿ**
   - è§£é”æ‰€æœ‰æ­¦å™¨è·å¾—ç‰¹æ®Šå¥–åŠ±

3. **æŠ˜æ‰£ç³»ç»Ÿ**
   - ç‰¹å®šæ¡ä»¶ä¸‹è§£é”æ¶ˆè€—å‡å°‘

4. **æ­¦å™¨è¯•ç”¨**
   - æœªè§£é”æ­¦å™¨å¯ä»¥åœ¨ç‰¹å®šå…³å¡ä¸­è¯•ç”¨

5. **è¿”è¿˜æœºåˆ¶**
   - å…è®¸ç©å®¶å°†æ­¦å™¨"å–å›"è·å¾—éƒ¨åˆ†èµ„æº

---

**ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2025-11-02  
**ä½œè€…**ï¼šPress Any Key å¼€å‘å›¢é˜Ÿ
